# bbq â€” BQN Based Quant
# examples/mc_convergence.bqn â€” Monte Carlo vs Black-Scholes convergence demo

mc â† â€¢Import "../engine/mc.bqn"
opt â† â€¢Import "../engine/opt.bqn"

# â”€â”€ Formatting (local) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Rd4 â€” round to 4 decimal places
Rd4 â† {
  v â† âŒŠ0.5+10000Ã—|ğ•©
  d â† Â¯4â†‘"0000"âˆ¾â€¢Fmt 10000|v
  ((ğ•©<0)/"-") âˆ¾ (â€¢Fmt âŒŠvÃ·10000) âˆ¾ "." âˆ¾ d
}

# LPad â€” left-pad string to width (right-align)
LPad â† {((ğ•¨-â‰ ğ•©)â¥Š' ')âˆ¾ğ•©}

# â”€â”€ Convergence Test â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

s0 â† 100
k â† 100
r â† 0.05
sig â† 0.20
t â† 1
steps â† 252

bsPrice â† opt.BS s0â€¿kâ€¿tâ€¿râ€¿sigâ€¿1

â€¢Out "Monte Carlo vs Black-Scholes Convergence"
â€¢Out "Sâ‚€=100  K=100  r=0.05  Ïƒ=0.20  T=1  steps=252"
â€¢Out "BS analytical: " âˆ¾ Rd4 bsPrice
â€¢Out ""
â€¢Out "  Paths â”‚   MC Price â”‚   BS Price â”‚     Error â”‚    Secs"
â€¢Out "â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€"

{
  n â† ğ•©
  t0 â† â€¢MonoTime@
  paths â† mc.Paths nâ€¿s0â€¿râ€¿sigâ€¿tâ€¿steps
  mcPrice â† kâŠ¸mc.EuroCall mc._Price pathsâ€¿râ€¿t
  elapsed â† (â€¢MonoTime@)-t0
  err â† mcPrice - bsPrice
  row â† (8 LPad â€¢Fmt n) âˆ¾ " â”‚ " âˆ¾ (10 LPad Rd4 mcPrice) âˆ¾ " â”‚ " âˆ¾ (10 LPad Rd4 bsPrice) âˆ¾ " â”‚ " âˆ¾ (9 LPad Rd4 err) âˆ¾ " â”‚ " âˆ¾ (7 LPad Rd4 elapsed)
  â€¢Out row
}Â¨ 1000â€¿5000â€¿10000â€¿50000â€¿100000
