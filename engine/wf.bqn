# bbq â€” BQN Based Quant
# engine/wf.bqn â€” walk-forward validation

bt â† â€¢Import "bt.bqn"

# Re-export bt (which includes core)
âŸ¨Load, Validate, Align,
 MA, EMA, WMA, Std, RSI, MACD, ATR, Mom, ROC, Stoch, BB, OBV, VWAP, AD, RMax, RMin,
 Cross, CrossDown, Mask, Fill, Thresh, ThreshDown, Hold,
 _Sim, Ret, LogRet, Run, Cost, Equity,
 Sharpe, Sortino, MaxDD, MaxDDDur, TotalRet, CAGR, AnnVol, Calmar,
 WinRate, ProfitFactor, AvgWin, AvgLoss, Expectancy, Trades, TimeIn, Exposure, Skew, Kurt,
 Report, PortRun, PortCost, PortEquity, PortReportâŸ© â‡ bt

# â”€â”€ Walk-Forward â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# trainâ€¿test Windows prices â€” rolling train/test window splits
Windows â‡ {
  trâ€¿te â† ğ•¨ â‹„ p â† ğ•©
  nf â† 1+âŒŠ((â‰ p)-tr+te)Ã·te
  ! nf>0
  {s â† ğ•©Ã—te â‹„ âŸ¨trâ†‘sâ†“p, teâ†‘(s+tr)â†“pâŸ©}Â¨ â†•nf
}

# Grid ranges â€” cartesian product of parameter ranges
Grid â‡ {
  ! 0<â‰ ğ•©
  1=â‰ ğ•© ? <Â¨âŠ‘ğ•©;
  rest â† ğ•Š 1â†“ğ•©
  âˆ¾ {ğ•©âŠ¸âˆ¾Â¨ rest}Â¨ âŠ‘ğ•©
}
